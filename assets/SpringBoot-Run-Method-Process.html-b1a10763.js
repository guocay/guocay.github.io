import{_ as e,X as a,Y as r,Z as n}from"./framework-d314e57d.js";const i="/docs/images/20230426-003.png",t={},o=n('<figure><img src="'+i+'" alt="SpringBoot框架run函数执行流程" tabindex="0" loading="lazy"><figcaption>SpringBoot框架run函数执行流程</figcaption></figure><h2 id="记录启动时间" tabindex="-1"><a class="header-anchor" href="#记录启动时间" aria-hidden="true">#</a> 记录启动时间</h2><h2 id="createbootstrapcontext-创建启动上下文" tabindex="-1"><a class="header-anchor" href="#createbootstrapcontext-创建启动上下文" aria-hidden="true">#</a> createBootstrapContext(): 创建启动上下文</h2><blockquote><ul><li>创建一个 DefaultBootstrapContext 对象</li><li>执行所有注册的 BootstrapRegistryInitializer 对象</li></ul></blockquote><h2 id="configureheadlessproperty-配置属性" tabindex="-1"><a class="header-anchor" href="#configureheadlessproperty-配置属性" aria-hidden="true">#</a> configureHeadlessProperty(): 配置属性</h2><blockquote><p>系统变量 java.awt.headless 如果不存在,则设置成 headless 变量的值. 默认为 true</p></blockquote><h2 id="getrunlisteners-获取运行的监听器" tabindex="-1"><a class="header-anchor" href="#getrunlisteners-获取运行的监听器" aria-hidden="true">#</a> getRunListeners(): 获取运行的监听器</h2><blockquote><p>创建一个SpringApplicationRunListeners对象, 获取spring.factories中定义的 SpringApplicationRunListener 对象</p></blockquote><h2 id="监听器-starting事件" tabindex="-1"><a class="header-anchor" href="#监听器-starting事件" aria-hidden="true">#</a> 监听器 Starting事件</h2><blockquote><p>触发运行 SpringApplicationRunListener中定义的 spring.boot.application.starting 事件(starting函数)</p></blockquote><h2 id="包装启动参数为-defaultapplicationarguments对象" tabindex="-1"><a class="header-anchor" href="#包装启动参数为-defaultapplicationarguments对象" aria-hidden="true">#</a> 包装启动参数为 DefaultApplicationArguments对象</h2><h2 id="prepareenvironment-准备环境" tabindex="-1"><a class="header-anchor" href="#prepareenvironment-准备环境" aria-hidden="true">#</a> prepareEnvironment(): 准备环境</h2><h3 id="getorcreateenvironment-获取或创建环境" tabindex="-1"><a class="header-anchor" href="#getorcreateenvironment-获取或创建环境" aria-hidden="true">#</a> getOrCreateEnvironment(): 获取或创建环境</h3><blockquote><ul><li>判断当前环境是否为空, 不为空则返回当前环境</li><li>判断应用类型, Servlet类型则创建并返回 ApplicationServletEnvironment 实例</li><li>判断应用类型, Reactive类型则创建并返回 ApplicationReactiveWebEnvironment实例</li><li>判断应用类型, 其他则创建并返回 ApplicationEnvironment实例</li></ul></blockquote><h3 id="configureenvironment-配置环境" tabindex="-1"><a class="header-anchor" href="#configureenvironment-配置环境" aria-hidden="true">#</a> configureEnvironment(): 配置环境</h3><h4 id="判断-addconversionservice-属性-为真则创建一个-applicationconversionservice-并加入-env-对象" tabindex="-1"><a class="header-anchor" href="#判断-addconversionservice-属性-为真则创建一个-applicationconversionservice-并加入-env-对象" aria-hidden="true">#</a> 判断 addConversionService 属性, 为真则创建一个 ApplicationConversionService 并加入 env 对象</h4><h4 id="configurepropertysources-配置属性源" tabindex="-1"><a class="header-anchor" href="#configurepropertysources-配置属性源" aria-hidden="true">#</a> configurePropertySources(): 配置属性源</h4><blockquote><ul><li>判断 defaultProperties 属性是否为空集合,是则将当前环境中的属性源添加合并到 defaultProperties属性中</li><li>判断是否存在 启动参数 和 判断 属性源中 是否存在 CommandLinePropertySource.COMMAND_LINE_PROPERTY_SOURCE_NAME 的属性</li><li>上一步判断如果已经存在命令行属性,就创建一个 CompositePropertySource 实例,合并已有的参数和新加的参数后, 替换原有的属性值.</li><li>上一步如果不存在, 就新建一个 SimpleCommandLinePropertySource 实例封装启动参数, 并添加当当前环境的属性源的第一个位置.</li></ul></blockquote><h4 id="configureprofiles-钩子函数-例如用于通过命令行激活配置文件" tabindex="-1"><a class="header-anchor" href="#configureprofiles-钩子函数-例如用于通过命令行激活配置文件" aria-hidden="true">#</a> configureProfiles(): 钩子函数, 例如用于通过命令行激活配置文件</h4><h3 id="configurationpropertysources-attach-为环境添加附加源" tabindex="-1"><a class="header-anchor" href="#configurationpropertysources-attach-为环境添加附加源" aria-hidden="true">#</a> ConfigurationPropertySources.attach(): 为环境添加附加源</h3><blockquote><ul><li>断言 env 对象 是否是 ConfigurableEnvironment 的子类实现.</li><li>从 env 对象中获取 属性源, 从属性源中获取 configurationProperties 的值.</li><li>如果上一步获取到的值为空,或 属性源不是可用的数据源. 就通过 SpringConfigurationPropertySources 创建一个 ConfigurationPropertySourcesPropertySource 实例</li><li>删除属性源中原来的值,并将新值加进去(添加到第一个位置).</li></ul></blockquote><h3 id="environmentprepared-监听器-环境就绪事件" tabindex="-1"><a class="header-anchor" href="#environmentprepared-监听器-环境就绪事件" aria-hidden="true">#</a> environmentPrepared(): 监听器 环境就绪事件</h3><h3 id="defaultpropertiespropertysource-movetoend-移动默认属性" tabindex="-1"><a class="header-anchor" href="#defaultpropertiespropertysource-movetoend-移动默认属性" aria-hidden="true">#</a> DefaultPropertiesPropertySource.moveToEnd(): 移动默认属性</h3><blockquote><ul><li>在属性源中获取并删除 defaultProperties 的值;</li><li>将上一步获取到的值添加到属性源的末尾;</li></ul></blockquote><h3 id="断言-是否包含-spring-main-environment-prefix" tabindex="-1"><a class="header-anchor" href="#断言-是否包含-spring-main-environment-prefix" aria-hidden="true">#</a> 断言 是否包含 spring.main.environment-prefix</h3><h3 id="bindtospringapplication-将环境绑定到springapplication" tabindex="-1"><a class="header-anchor" href="#bindtospringapplication-将环境绑定到springapplication" aria-hidden="true">#</a> bindToSpringApplication(): 将环境绑定到SpringApplication</h3><blockquote><p>将 属性源 以 spring.main 为name, 绑定到 Binder上</p></blockquote><h3 id="如果不是自定义的环境-就创建一个-environmentconverter-对象-将环境转换为-environmentstandardenvironment-如果必要" tabindex="-1"><a class="header-anchor" href="#如果不是自定义的环境-就创建一个-environmentconverter-对象-将环境转换为-environmentstandardenvironment-如果必要" aria-hidden="true">#</a> 如果不是自定义的环境, 就创建一个 EnvironmentConverter 对象 将环境转换为 environmentStandardEnvironment, 如果必要</h3><blockquote><p>根据 webApplicationType 属性将 env 对象转化为 ApplicationServletEnvironment, ApplicationReactiveWebEnvironment, ApplicationEnvironment之一.</p></blockquote><h3 id="configurationpropertysources-attach-再次为环境添加附加源" tabindex="-1"><a class="header-anchor" href="#configurationpropertysources-attach-再次为环境添加附加源" aria-hidden="true">#</a> ConfigurationPropertySources.attach(): 再次为环境添加附加源</h3><blockquote><p>同上</p></blockquote><h2 id="configureignorebeaninfo-配置忽略的bean信息" tabindex="-1"><a class="header-anchor" href="#configureignorebeaninfo-配置忽略的bean信息" aria-hidden="true">#</a> configureIgnoreBeanInfo(): 配置忽略的bean信息</h2><blockquote><p>如果环境变量中不存在 spring.beaninfo.ignore 就将其设置为true</p></blockquote><h2 id="printbanner-准备-banner-信息" tabindex="-1"><a class="header-anchor" href="#printbanner-准备-banner-信息" aria-hidden="true">#</a> printBanner(): 准备 Banner 信息</h2><blockquote><ul><li>判断是否开启了 Banner打印, 关闭则直接返回.</li><li>判断是否存在 ResourceLoader 属性, 没有则创建一个 DefaultResourceLoader 实例</li><li>创建一个 SpringApplicationBannerPrinter 对象, 根据SpringApplication类中设置banner属性.</li><li>判断日志对象是否存在, 存在则使用日志对象打印. 否则通过 System.out 属性打印.</li></ul></blockquote><h2 id="createapplicationcontext-创建应用上下文" tabindex="-1"><a class="header-anchor" href="#createapplicationcontext-创建应用上下文" aria-hidden="true">#</a> createApplicationContext(): 创建应用上下文</h2><blockquote><p>通过 applicationContextFactory 属性 和 webApplicationType属性 创建 ApplicationContext, Servlet类型创建 AnnotationConfigServletWebServerApplicationContext 实例, Reactive类型创建 AnnotationConfigReactiveWebServerApplicationContext 实例</p></blockquote><h2 id="设置启动步骤" tabindex="-1"><a class="header-anchor" href="#设置启动步骤" aria-hidden="true">#</a> 设置启动步骤</h2><blockquote><p>设置 ApplicationContext 的 applicationStartup 属性为 DefaultApplicationStartup 实例</p></blockquote><h2 id="preparecontext-准备上下文" tabindex="-1"><a class="header-anchor" href="#preparecontext-准备上下文" aria-hidden="true">#</a> prepareContext(): 准备上下文</h2><h3 id="设置-context-的环境" tabindex="-1"><a class="header-anchor" href="#设置-context-的环境" aria-hidden="true">#</a> 设置 context 的环境</h3><h3 id="postprocessapplicationcontext-应用上下文的后置处理" tabindex="-1"><a class="header-anchor" href="#postprocessapplicationcontext-应用上下文的后置处理" aria-hidden="true">#</a> postProcessApplicationContext(): 应用上下文的后置处理;</h3><blockquote><ul><li>如果 beanNameGenerator 属性不为空, 以 org.springframework.context.annotation.internalConfigurationBeanNameGenerator 为 key将其加入BeanFactory;</li><li>如果 resourceLoader 属性不为空,且 context 对象为GenericApplicationContext的实例,则将其设置为context对象的ResourceLoader</li><li>如果 resourceLoader 属性不为空,且 context 对象为DefaultResourceLoader的实例,则将其的ClassLoader设置为context对象的ClassLoader</li><li>如果 addConversionService 属性为真, 则将env对象中的 ConversionService 设置为 BeanFactory的 ConversionService</li></ul></blockquote><h3 id="applyinitializers-执行-初始化回调" tabindex="-1"><a class="header-anchor" href="#applyinitializers-执行-初始化回调" aria-hidden="true">#</a> applyInitializers(): 执行 初始化回调</h3><blockquote><p>执行通过 SpringApplication类的 addInitializers(), setInitializers() 函数添加的 ApplicationContextInitializer实现类</p></blockquote><h3 id="监听器-上下文就绪事件" tabindex="-1"><a class="header-anchor" href="#监听器-上下文就绪事件" aria-hidden="true">#</a> 监听器 上下文就绪事件</h3><h3 id="defaultbootstrapcontext-close-关闭启动上下文" tabindex="-1"><a class="header-anchor" href="#defaultbootstrapcontext-close-关闭启动上下文" aria-hidden="true">#</a> DefaultBootstrapContext.close(): 关闭启动上下文</h3><blockquote><p>发布 启动上下文 关闭事件</p></blockquote><h3 id="判断是否打印启动信息-是则打印-是否主容器-和-配置信息" tabindex="-1"><a class="header-anchor" href="#判断是否打印启动信息-是则打印-是否主容器-和-配置信息" aria-hidden="true">#</a> 判断是否打印启动信息, 是则打印 是否主容器 和 配置信息</h3><h3 id="在beanfactory中注册-applicationarguments-启动参数的封装-实例" tabindex="-1"><a class="header-anchor" href="#在beanfactory中注册-applicationarguments-启动参数的封装-实例" aria-hidden="true">#</a> 在BeanFactory中注册 ApplicationArguments(启动参数的封装) 实例,</h3><h3 id="如果存在-banner对象-则注册到-beanfactory中" tabindex="-1"><a class="header-anchor" href="#如果存在-banner对象-则注册到-beanfactory中" aria-hidden="true">#</a> 如果存在 Banner对象, 则注册到 BeanFactory中.</h3><h3 id="判断如果beanfactory是abstractautowirecapablebeanfactory的实例-则设置允许循环引用为-allowcircularreferences-属性的值" tabindex="-1"><a class="header-anchor" href="#判断如果beanfactory是abstractautowirecapablebeanfactory的实例-则设置允许循环引用为-allowcircularreferences-属性的值" aria-hidden="true">#</a> 判断如果BeanFactory是AbstractAutowireCapableBeanFactory的实例,则设置允许循环引用为 allowCircularReferences 属性的值</h3><h3 id="判断如果beanfactory是-defaultlistablebeanfactory-的实例-则设置允许bean定义覆盖为-allowbeandefinitionoverriding属性的值" tabindex="-1"><a class="header-anchor" href="#判断如果beanfactory是-defaultlistablebeanfactory-的实例-则设置允许bean定义覆盖为-allowbeandefinitionoverriding属性的值" aria-hidden="true">#</a> 判断如果BeanFactory是 DefaultListableBeanFactory 的实例, 则设置允许Bean定义覆盖为 allowBeanDefinitionOverriding属性的值</h3><h3 id="判断如果-lazyinitialization-属性的值为true-为上下文设置一个-lazyinitializationbeanfactorypostprocessor-实例" tabindex="-1"><a class="header-anchor" href="#判断如果-lazyinitialization-属性的值为true-为上下文设置一个-lazyinitializationbeanfactorypostprocessor-实例" aria-hidden="true">#</a> 判断如果 lazyInitialization 属性的值为true, 为上下文设置一个 LazyInitializationBeanFactoryPostProcessor 实例</h3><h3 id="为上下文添加一个-propertysourceorderingbeanfactorypostprocessor-实例" tabindex="-1"><a class="header-anchor" href="#为上下文添加一个-propertysourceorderingbeanfactorypostprocessor-实例" aria-hidden="true">#</a> 为上下文添加一个 PropertySourceOrderingBeanFactoryPostProcessor 实例</h3><h3 id="getallsources-获取所有资源" tabindex="-1"><a class="header-anchor" href="#getallsources-获取所有资源" aria-hidden="true">#</a> getAllSources(): 获取所有资源</h3><blockquote><ul><li>获取 primarySources 属性中定义的资源</li><li>获取 sources 属性中定义的资源</li></ul></blockquote><h3 id="断言-上一步获取的资源不得为空" tabindex="-1"><a class="header-anchor" href="#断言-上一步获取的资源不得为空" aria-hidden="true">#</a> 断言 上一步获取的资源不得为空.</h3><h3 id="load-加载上上步中获取的资源" tabindex="-1"><a class="header-anchor" href="#load-加载上上步中获取的资源" aria-hidden="true">#</a> load(): 加载上上步中获取的资源</h3><blockquote><ul><li>创建一个 BeanDefinitionLoader 实例</li><li>为 BeanDefinitionLoader 设置 BeanNameGenerator</li><li>为 BeanDefinitionLoader 设置 ResourceLoader</li><li>为 BeanDefinitionLoader 设置 Environment</li><li>load(): 执行加载Bean信息</li></ul></blockquote><h3 id="监听器-上下文加载完成事件" tabindex="-1"><a class="header-anchor" href="#监听器-上下文加载完成事件" aria-hidden="true">#</a> 监听器 上下文加载完成事件</h3><h2 id="afterrefresh-钩子函数-用于子类调用扩展" tabindex="-1"><a class="header-anchor" href="#afterrefresh-钩子函数-用于子类调用扩展" aria-hidden="true">#</a> afterRefresh(): 钩子函数, 用于子类调用扩展</h2><h2 id="如果开启-打印启动日志-则创建一个-startupinfologger-对象" tabindex="-1"><a class="header-anchor" href="#如果开启-打印启动日志-则创建一个-startupinfologger-对象" aria-hidden="true">#</a> 如果开启 打印启动日志.则创建一个 StartupInfoLogger 对象</h2><h2 id="监听器-启动完成事件" tabindex="-1"><a class="header-anchor" href="#监听器-启动完成事件" aria-hidden="true">#</a> 监听器 启动完成事件</h2><h2 id="callrunners-运行声明的-applicationrunner对象的run函数" tabindex="-1"><a class="header-anchor" href="#callrunners-运行声明的-applicationrunner对象的run函数" aria-hidden="true">#</a> callRunners(): 运行声明的 ApplicationRunner对象的run函数;</h2><blockquote><ul><li>获取BeanFactory中的 ApplicationRunner 接口实例</li><li>获取BeanFactory中的 CommandLineRunner 接口实例</li><li>通过 AnnotationAwareOrderComparator.sort() 函数对上两步中获取到的实例进行排序;</li></ul></blockquote><h2 id="监听器-读事件" tabindex="-1"><a class="header-anchor" href="#监听器-读事件" aria-hidden="true">#</a> 监听器 读事件</h2>',67),c=[o];function l(d,h){return a(),r("div",null,c)}const p=e(t,[["render",l],["__file","SpringBoot-Run-Method-Process.html.vue"]]);export{p as default};
